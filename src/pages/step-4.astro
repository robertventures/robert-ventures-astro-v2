---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const pageTitle = "Robert Ventures: Step 4";
const pageDescription = "Let's finalize your account with a quick call.";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={pageTitle} description={pageDescription} />
        <meta name="robots" content="noindex, nofollow" />
        <style>
            body {
                background-color: #fff;
            }
            main {
                padding: 1.5rem;
                display: flex;
                flex-direction: column;
            }

            h1 {
                color: #000;
                text-align: center;
                font-family: "Satoshi", sans-serif;
                font-size: 1.4375rem;
                font-style: normal;
                font-weight: 700;
                line-height: 130%;
                margin-bottom: 1.5rem;
            }

            a {
                background-color: #5028ff;
                color: #fff;
                padding: 15px;
                line-height: 1;
                font-family: Inter, sans-serif;
                font-size: 1.125rem;
                font-weight: 500;
                border-radius: 0.75rem;
                border: 1px solid #5028ff;
                margin-top: 2rem;
                text-decoration: none;
                text-align: center;
                display: none;
            }
        </style>
    </head>
    <body>
        <Header />

        <main>
            <h1 class="heading">
                Let's finalize your account with a quick call
            </h1>

            <iframe
                src="https://api.leadconnectorhq.com/widget/booking/xNXEISjf314X2BFZvdaZ"
                style="width: 100%;border:none;overflow: hidden;"
                scrolling="no"
                id="xNXEISjf314X2BFZvdaZ_1727445052062"
            >
            </iframe>
            <script
                src="https://link.msgsndr.com/js/form_embed.js"
                type="text/javascript"></script>

            <a class="button" href="https://invest.robertventures.com/login?f=1"
                >Log In</a
            >
        </main>
        <Footer />
    </body>
</html>

<script is:inline>
    window.addEventListener("message", (event) => {
        console.log("üì© Message from iframe:", event);

        // Ensure the message comes from GoHighLevel (LeadConnector)
        if (!event.origin.includes("leadconnectorhq.com")) {
            return;
        }

        // Log full event data
        console.log("üîç Full event data:", event.data);

        // ‚úÖ Detect booking completion event
        if (
            Array.isArray(event.data) &&
            event.data[0] === "msgsndr-booking-complete"
        ) {
            triggerEvent("book_a_call", "bookACall");
            console.log("‚úÖ Booking detected! Redirecting user to /login...");
            document.querySelector("h1.heading").style.display = "none";
            document.querySelector("a.button").style.display = "block";
        }
    });
</script>
