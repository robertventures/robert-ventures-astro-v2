---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const pageTitle = "Robert Ventures: Step 4";
const pageDescription = "Let's finalize your account with a quick call.";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={pageTitle} description={pageDescription} />
        <meta name="robots" content="noindex, nofollow" />
        <style>
            body {
                background-color: #fff;
            }
            main {
                padding: 1.5rem;
                display: flex;
                flex-direction: column;
            }

            h1 {
                color: #000;
                text-align: center;
                font-family: "Satoshi", sans-serif;
                font-size: 1.4375rem;
                font-style: normal;
                font-weight: 700;
                line-height: 130%;
                margin-bottom: 1.5rem;
            }

            a {
                background-color: #5028ff;
                color: #fff;
                padding: 15px;
                line-height: 1;
                font-family: Inter, sans-serif;
                font-size: 1.125rem;
                font-weight: 500;
                border-radius: 0.75rem;
                border: 1px solid #5028ff;
                margin-bottom: 2rem;
                text-decoration: none;
                text-align: center;
                display: none;
            }
        </style>

        <!-- Meta Pixel Code -->
        <script is:inline>
            !(function (f, b, e, v, n, t, s) {
                if (f.fbq) return;
                n = f.fbq = function () {
                    n.callMethod
                        ? n.callMethod.apply(n, arguments)
                        : n.queue.push(arguments);
                };
                if (!f._fbq) f._fbq = n;
                n.push = n;
                n.loaded = !0;
                n.version = "2.0";
                n.queue = [];
                t = b.createElement(e);
                t.async = !0;
                t.src = v;
                s = b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t, s);
            })(
                window,
                document,
                "script",
                "https://connect.facebook.net/en_US/fbevents.js",
            );
            fbq("init", "652212003052612");
            fbq("track", "CompleteRegistration");
        </script>
        <noscript
            ><img
                height="1"
                width="1"
                style="display:none"
                src="https://www.facebook.com/tr?id=652212003052612&ev=PageView&noscript=1"
            /></noscript
        >
        <!-- End Meta Pixel Code -->
    </head>
    <body>
        <Header />

        <main>
            <a class="button" href="https://invest.robertventures.com/login?f=1"
                >Start Investing</a
            >
            <h1 class="heading">
                Let's finalize your account with a quick call
            </h1>

            <iframe
                src="https://api.leadconnectorhq.com/widget/booking/xNXEISjf314X2BFZvdaZ"
                style="width: 100%;border:none;overflow: hidden;"
                scrolling="no"
                id="xNXEISjf314X2BFZvdaZ_1727445052062"
            >
            </iframe>
            <script
                src="https://link.msgsndr.com/js/form_embed.js"
                type="text/javascript"></script>
        </main>
        <Footer />
    </body>
</html>

<script is:inline>
    window.addEventListener("message", (event) => {
        console.log("üì© Message from iframe:", event);

        // Ensure the message comes from GoHighLevel (LeadConnector)
        if (!event.origin.includes("leadconnectorhq.com")) {
            return;
        }

        // Log full event data
        console.log("üîç Full event data:", event.data);

        // ‚úÖ Detect booking completion event
        if (
            Array.isArray(event.data) &&
            event.data[0] === "msgsndr-booking-complete"
        ) {
            triggerEvent("finalize_booking", "finalizeBooking");
            triggerEvent("invest_now", "investNow");

            console.log("‚úÖ Booking detected! Redirecting user to /login...");
            window.location.href =
                "https://invest.robertventures.com/offering/rob10/details";
            document.querySelector("h1.heading").style.display = "none";
            document.querySelector("a.button").style.display = "block";
        }
    });
</script>
